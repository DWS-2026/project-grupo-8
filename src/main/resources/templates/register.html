<!DOCTYPE html>
<html lang="es">

<head th:replace="~{fragments/head :: head('Inicio - HashPass')}"></head>

<body>

	<nav class="navbar navbar-expand-lg navbar-dark">
		<div class="container">
			<a class="navbar-brand fw-bold" th:href="@{/plan}">
				<i class="bi bi-shield-lock-fill me-2 text-success"></i>HashPass
			</a>
		</div>
	</nav>

	<main class="container py-5">
		<div class="row justify-content-center">
			<div class="col-md-6">
				<div class="card p-4" style="min-height: 750px;">
					<h3 class="mb-3 text-center">Crear nueva cuenta</h3>

					<div id="alert" class="alert d-none" role="alert"></div>

					<form id="registerForm" method="post" action="#">
						<div class="mb-3">
							<label for="fullname" class="form-label">Nombre completo</label>
							<div class="input-group">
								<input type="text" id="fullname" name="fullname" class="form-control login-email-input"
									placeholder="Ej: Michel Oyarzabal" required>
							</div>
						</div>

						<div class="mb-3">
							<label for="email" class="form-label">Correo electrÃ³nico</label>
							<div class="input-group">
								<input type="email" id="email" name="email" class="form-control login-email-input"
									placeholder="Correo electrÃ³nico" required>
							</div>
							<small id="emailError" class="form-text text-danger" style="display:none;">Correo
								electrÃ³nico invÃ¡lido</small>
							<small id="emailSuccess" class="form-text text-success" style="display:none;">Correo
								vÃ¡lido</small>
						</div>

						<div class="mb-3">
							<label for="phone" class="form-label">TelÃ©fono (opcional)</label>
							<div class="input-group">
								<select id="country-code" class="form-select"
									style="flex: 0 0 auto; width: auto; border-radius: 6px 0 0 6px !important;">
									<option value="+34">ğŸ‡ªğŸ‡¸ +34 (EspaÃ±a)</option>
									<option value="+1">ğŸ‡ºğŸ‡¸ +1 (EE.UU.)</option>
									<option value="+44">ğŸ‡¬ğŸ‡§ +44 (Reino Unido)</option>
									<option value="+33">ğŸ‡«ğŸ‡· +33 (Francia)</option>
									<option value="+49">ğŸ‡©ğŸ‡ª +49 (Alemania)</option>
									<option value="+39">ğŸ‡®ğŸ‡¹ +39 (Italia)</option>
									<option value="+43">ğŸ‡¦ğŸ‡¹ +43 (Austria)</option>
									<option value="+41">ğŸ‡¨ğŸ‡­ +41 (Suiza)</option>
									<option value="+31">ğŸ‡³ğŸ‡± +31 (PaÃ­ses Bajos)</option>
									<option value="+32">ğŸ‡§ğŸ‡ª +32 (BÃ©lgica)</option>
									<option value="+351">ğŸ‡µğŸ‡¹ +351 (Portugal)</option>
									<option value="+48">ğŸ‡µğŸ‡± +48 (Polonia)</option>
									<option value="+46">ğŸ‡¸ğŸ‡ª +46 (Suecia)</option>
									<option value="+47">ğŸ‡³ğŸ‡´ +47 (Noruega)</option>
									<option value="+45">ğŸ‡©ğŸ‡° +45 (Dinamarca)</option>
									<option value="+358">ğŸ‡«ğŸ‡® +358 (Finlandia)</option>
									<option value="+55">ğŸ‡§ğŸ‡· +55 (Brasil)</option>
									<option value="+52">ğŸ‡²ğŸ‡½ +52 (MÃ©xico)</option>
									<option value="+54">ğŸ‡¦ğŸ‡· +54 (Argentina)</option>
									<option value="+56">ğŸ‡¨ğŸ‡± +56 (Chile)</option>
									<option value="+57">ğŸ‡¨ğŸ‡´ +57 (Colombia)</option>
									<option value="+591">ğŸ‡§ğŸ‡´ +591 (Bolivia)</option>
									<option value="+598">ğŸ‡ºğŸ‡¾ +598 (Uruguay)</option>
									<option value="+81">ğŸ‡¯ğŸ‡µ +81 (JapÃ³n)</option>
									<option value="+86">ğŸ‡¨ğŸ‡³ +86 (China)</option>
									<option value="+91">ğŸ‡®ğŸ‡³ +91 (India)</option>
									<option value="+82">ğŸ‡°ğŸ‡· +82 (Corea del Sur)</option>
									<option value="+60">ğŸ‡²ğŸ‡¾ +60 (Malasia)</option>
									<option value="+65">ğŸ‡¸ğŸ‡¬ +65 (Singapur)</option>
									<option value="+61">ğŸ‡¦ğŸ‡º +61 (Australia)</option>
									<option value="+64">ğŸ‡³ğŸ‡¿ +64 (Nueva Zelanda)</option>
									<option value="+27">ğŸ‡¿ğŸ‡¦ +27 (SudÃ¡frica)</option>
								</select>
								<input type="tel" id="phone" name="phone" class="form-control login-email-input"
									placeholder="NÃºmero de telÃ©fono" style="border-radius: 0 6px 6px 0 !important;">
							</div>
						</div>

						<div class="mb-3 mt-4 mt-5">
							<label for="password" class="form-label">ContraseÃ±a Maestra</label>
							<div class="input-group">
								<input type="password" id="password" name="password"
									class="form-control login-email-input" placeholder="ContraseÃ±a segura" required>
								<button class="btn btn-outline-secondary" type="button" aria-label="Mostrar contraseÃ±a"
									onclick="togglePasswordRegister(event)"><i class="bi bi-eye"></i></button>
							</div>
							<!-- Indicador de fortaleza -->
							<label class="form-label mt-3">Nivel de seguridad de la contraseÃ±a</label>
							<div class="progress" style="height: 6px;">
								<div id="strengthBar" class="progress-bar"></div>
							</div>
							<small id="strengthText" class="form-text text-white-50">MÃ­nimo 8 caracteres, con mayÃºsculas,
								nÃºmeros y sÃ­mbolos.</small>
						</div>

						<div class="mb-3">
							<label for="confirm-password" class="form-label">Confirmar ContraseÃ±a</label>
							<div class="input-group">
								<input type="password" id="confirm-password" name="confirm-password"
									class="form-control login-email-input" placeholder="Repite tu contraseÃ±a" required>
								<button class="btn btn-outline-secondary" type="button" aria-label="Mostrar contraseÃ±a"
									onclick="toggleConfirmPasswordRegister(event)"><i class="bi bi-eye"></i></button>
							</div>
						</div>

						<div class="mb-3 form-check">
							<input type="checkbox" class="form-check-input" id="terms" name="terms" required>
							<label class="form-check-label" for="terms">
								Acepto los <a href="#" class="muted-link">tÃ©rminos y condiciones</a>
							</label>
						</div>
						<div class="mb-3">
							<label for="avatar" class="form-label">Foto de perfil (Opcional)</label>
							<input type="file" class="form-control login-email-input" id="avatar" accept="image/*">
						</div>

						<div class="d-grid gap-2">
							<button id="registerBtn" class="btn btn-primary w-100 fw-bold" type="submit"
								href="passwords.html" disabled style="font-weight: 800;">Crear cuenta</button>
						</div>
					</form>

					<div class="mt-4 text-center">
						<p>Â¿Ya tienes cuenta? <a href="login.html" class="muted-link">Inicia sesiÃ³n aquÃ­</a></p>
					</div>

					<!-- Recuadro con logo similar a password-login -->
					<div style="margin-top:36px;margin-bottom:25px;text-align:center;">
						<a class="navbar-brand brand-logo-large lower-logo" style="display:inline-flex;align-items:center;justify-content:center;">
							<i class="bi bi-shield-lock-fill text-success"></i>
							<span>HashPass</span>
						</a>
					</div>
				</div>
			</div>
		</div>
	</main>

	<footer th:replace="~{fragments/footer :: footerPrivate}"></footer>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/zxcvbn@4.4.2/dist/zxcvbn.js"></script>

	<script>
		const passwordInput = document.getElementById('password');
		const emailInput = document.getElementById('email');
		const strengthBar = document.getElementById('strengthBar');
		const strengthText = document.getElementById('strengthText');
		const emailError = document.getElementById('emailError');
		const emailSuccess = document.getElementById('emailSuccess');

		const levels = [
			{ text: "Muy dÃ©bil", class: "bg-danger", width: "20%" },
			{ text: "DÃ©bil", class: "bg-warning", width: "40%" },
			{ text: "Aceptable", class: "bg-info", width: "60%" },
			{ text: "Fuerte", class: "bg-primary", width: "80%" },
			{ text: "Muy fuerte", class: "bg-success", width: "100%" }
		];

		// Validar formato de email
		function isValidEmail(email) {
			const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			return emailRegex.test(email);
		}

		emailInput.addEventListener('input', () => {
			const email = emailInput.value.trim();

			if (!email) {
				emailError.style.display = 'none';
				emailSuccess.style.display = 'none';
			} else if (isValidEmail(email)) {
				emailError.style.display = 'none';
				emailSuccess.style.display = 'block';
			} else {
				emailError.style.display = 'block';
				emailSuccess.style.display = 'none';
			}

			validateForm();
		});

		function togglePasswordRegister(ev) {
			const input = document.getElementById('password');
			const icon = ev.currentTarget.querySelector('i');

			if (input.type === "password") {
				input.type = "text";
				icon.classList.replace('bi-eye', 'bi-eye-slash');
			} else {
				input.type = "password";
				icon.classList.replace('bi-eye-slash', 'bi-eye');
			}
		}

		function toggleConfirmPasswordRegister(ev) {
			const input = document.getElementById('confirm-password');
			const icon = ev.currentTarget.querySelector('i');

			if (input.type === "password") {
				input.type = "text";
				icon.classList.replace('bi-eye', 'bi-eye-slash');
			} else {
				input.type = "password";
				icon.classList.replace('bi-eye-slash', 'bi-eye');
			}
		}

		// Validar seguridad y fortaleza de contraseÃ±a
		passwordInput.addEventListener('input', () => {
			const value = passwordInput.value;

			if (!value) {
				strengthBar.style.width = "0%";
				strengthBar.className = "progress-bar";
				strengthText.textContent = "MÃ­nimo 8 caracteres con mayÃºsculas, nÃºmeros y sÃ­mbolos.";
				validateForm();
				return;
			}

			const result = zxcvbn(value);
			const level = levels[result.score];

			strengthBar.style.width = level.width;
			strengthBar.className = `progress-bar ${level.class}`;
			strengthText.textContent = `Nivel: ${level.text}`;

			validateForm();
		});

		// Validar que todos los campos estÃ©n rellenos y tÃ©rminos aceptados
		function validateForm() {
			const fullname = document.getElementById('fullname').value.trim();
			const email = document.getElementById('email').value.trim();
			const password = document.getElementById('password').value.trim();
			const confirmPassword = document.getElementById('confirm-password').value.trim();
			const terms = document.getElementById('terms').checked;

			const btn = document.getElementById('registerBtn');

			// Verificar si el email es vÃ¡lido
			const emailValid = isValidEmail(email);

			// Verificar si la contraseÃ±a es lo suficientemente fuerte (score >= 3)
			let passwordStrong = false;
			if (password) {
				const result = zxcvbn(password);
				passwordStrong = result.score >= 3;
			}

			const isValid = fullname && email && emailValid && password && confirmPassword && terms && passwordStrong && password === confirmPassword;

			btn.disabled = !isValid;
		}

		// Agregar event listeners a todos los inputs
		document.addEventListener('DOMContentLoaded', () => {
			document.getElementById('fullname').addEventListener('input', validateForm);
			document.getElementById('password').addEventListener('input', validateForm);
			document.getElementById('confirm-password').addEventListener('input', validateForm);
			document.getElementById('terms').addEventListener('change', validateForm);
		});
	</script>

</body>

</html>